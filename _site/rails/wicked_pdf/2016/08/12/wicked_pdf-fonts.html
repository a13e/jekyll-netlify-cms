<p><img src="https://pbs.twimg.com/profile_images/691206086955790336/CDMbA57p.png" width="100%" /></p>

<h2 id="問題">問題</h2>
<p>ローカル環境だとうまく動作して検証用EC2へデプロイしてPDF表示したら日本語部分がことごとく文字化けしてしまう。</p>

<h2 id="原因">原因</h2>

<ol>
  <li>EC2にwkhtmltopdfがインストールされていなかった
    <ul>
      <li>wicked_pdfはwkhtmltopdfをRailsで扱っている感じなので当然ながら必要だった</li>
    </ul>
  </li>
  <li>EC2に日本語フォントがインストールされてなかった</li>
</ol>

<h2 id="やったこと">やったこと</h2>

<h3 id="wkhtmltopdfインストール">wkhtmltopdfインストール</h3>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">mkdir</span> <span class="sr">/home/e</span><span class="n">c2</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">downloads</span>
<span class="err">$</span> <span class="n">cd</span> <span class="sr">/home/e</span><span class="n">c2</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">downloads</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="n">wget</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">download</span><span class="p">.</span><span class="nf">gna</span><span class="p">.</span><span class="nf">org</span><span class="o">/</span><span class="n">wkhtmltopdf</span><span class="o">/</span><span class="mf">0.12</span><span class="o">/</span><span class="mf">0.12</span><span class="o">.</span><span class="mf">2.1</span><span class="o">/</span><span class="n">wkhtmltox</span><span class="o">-</span><span class="mf">0.12</span><span class="o">.</span><span class="mf">2.1</span><span class="n">_linux</span><span class="o">-</span><span class="n">centos6</span><span class="o">-</span><span class="n">amd64</span><span class="p">.</span><span class="nf">rpm</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">xorg</span><span class="o">-</span><span class="n">x11</span><span class="o">-</span><span class="n">fonts</span><span class="o">-</span><span class="mi">75</span><span class="n">dpi</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="n">rpm</span> <span class="o">-</span><span class="n">ivh</span> <span class="n">wkhtmltox</span><span class="o">-</span><span class="mf">0.12</span><span class="o">.</span><span class="mf">2.1</span><span class="n">_linux</span><span class="o">-</span><span class="n">centos6</span><span class="o">-</span><span class="n">amd64</span><span class="p">.</span><span class="nf">rpm</span></code></pre></figure>

<h3 id="日本語フォントインストール">日本語フォントインストール</h3>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">cd</span> <span class="sr">/usr/s</span><span class="n">hare</span><span class="o">/</span><span class="n">fonts</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="n">wget</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">download</span><span class="p">.</span><span class="nf">forest</span><span class="p">.</span><span class="nf">impress</span><span class="p">.</span><span class="nf">co</span><span class="p">.</span><span class="nf">jp</span><span class="o">/</span><span class="n">pub</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">i</span><span class="o">/</span><span class="n">ipafont</span><span class="o">/</span><span class="mi">10483</span><span class="o">/</span><span class="no">IPAfont00303</span><span class="p">.</span><span class="nf">zip</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="n">unzip</span> <span class="no">IPAfont00303</span><span class="p">.</span><span class="nf">zip</span>
<span class="err">$</span> <span class="n">fc</span><span class="o">-</span><span class="n">cache</span> <span class="o">-</span><span class="n">fv</span>

<span class="c1"># インストールされているか確認</span>
<span class="err">$</span> <span class="n">fc</span><span class="o">-</span><span class="n">list</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="n">ipa</span>
<span class="c1"># IPAゴシック,IPAGothic:style=Regular</span>
<span class="c1"># IPA Pゴシック,IPAPGothic:style=Regular</span>
<span class="c1"># IPA明朝,IPAMincho:style=Regular</span>
<span class="c1"># IPA P明朝,IPAPMincho:style=Regular</span></code></pre></figure>

<h2 id="参考">参考</h2>
<p>http://qiita.com/metheglin/items/bb88aa25eae250bfa2a2
http://hacknote.jp/archives/16712/</p>

